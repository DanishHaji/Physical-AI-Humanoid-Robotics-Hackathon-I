# Deployment Guide

Complete guide to deploy your Physical AI Textbook to Vercel (frontend) and Render (backend).

## Prerequisites

- GitHub account with your repository pushed
- Vercel account (free): https://vercel.com/signup
- Render account (free): https://render.com/register
- API keys from:
  - Groq API: https://console.groq.com
  - Qdrant Cloud: https://cloud.qdrant.io
  - Neon PostgreSQL: https://neon.tech

---

## Part 1: Deploy Backend to Render

### Step 1: Create Render Account
1. Go to https://render.com/register
2. Sign up with your GitHub account
3. Authorize Render to access your repositories

### Step 2: Create New Web Service
1. Click **"New +"** → **"Web Service"**
2. Connect your repository: `DanishHaji/Physical-AI-Humanoid-Robotics-Hackathon-I`
3. Configure the service:
   - **Name**: `physical-ai-textbook-api`
   - **Region**: Choose closest to you
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
   - **Instance Type**: **Free**

### Step 3: Add Environment Variables
Click **"Environment"** tab and add these variables:

```bash
# Required - Get from Groq Console
GROQ_API_KEY=your_groq_api_key_here

# Required - Get from Qdrant Cloud Dashboard
QDRANT_URL=https://your-cluster.cloud.qdrant.io
QDRANT_API_KEY=your_qdrant_api_key_here

# Required - Get from Neon Dashboard
DATABASE_URL=postgresql://user:pass@host/dbname?sslmode=require

# Optional - For authentication (auto-generated by Render if not provided)
SECRET_KEY=your_secret_key_here

# Application Settings
ENVIRONMENT=production
APP_NAME=Physical AI Textbook RAG API
APP_VERSION=3.0.0
DEBUG=false

# RAG Configuration
RAG_TOP_K=5
RAG_SIMILARITY_THRESHOLD=0.7
EMBEDDING_MODEL=all-MiniLM-L6-v2
EMBEDDING_DEVICE=cpu
VECTOR_SIZE=384

# Qdrant Settings
QDRANT_COLLECTION_NAME=textbook_chunks
QDRANT_DISTANCE=Cosine

# Rate Limiting
RATE_LIMIT_PER_MINUTE=20
RATE_LIMIT_PER_HOUR=100
RATE_LIMIT_PER_DAY=1000

# CORS (will be updated after frontend deployment)
ALLOWED_ORIGINS=["https://your-vercel-app.vercel.app"]
```

### Step 4: Deploy
1. Click **"Create Web Service"**
2. Wait for deployment (5-10 minutes)
3. Copy your backend URL: `https://physical-ai-textbook-api.onrender.com`
4. Test it: Visit `https://physical-ai-textbook-api.onrender.com/health`

**Note**: Free tier sleeps after 15 minutes of inactivity. First request may take 30-60 seconds to wake up.

---

## Part 2: Deploy Frontend to Vercel

### Step 1: Create Vercel Account
1. Go to https://vercel.com/signup
2. Sign up with your GitHub account
3. Authorize Vercel to access your repositories

### Step 2: Import Project
1. Click **"Add New..."** → **"Project"**
2. Import your repository: `DanishHaji/Physical-AI-Humanoid-Robotics-Hackathon-I`
3. Vercel will auto-detect Docusaurus

### Step 3: Configure Build Settings
- **Framework Preset**: `Docusaurus`
- **Build Command**: `npm run build`
- **Output Directory**: `build`
- **Install Command**: `npm install`

### Step 4: Add Environment Variables
Click **"Environment Variables"** and add:

```bash
# Backend API URL (use your Render URL from Part 1)
REACT_APP_API_URL=https://physical-ai-textbook-api.onrender.com
```

### Step 5: Deploy
1. Click **"Deploy"**
2. Wait for deployment (2-3 minutes)
3. You'll get a URL like: `https://physical-ai-humanoid-robotics.vercel.app`

### Step 6: Update Backend CORS
1. Go back to Render dashboard
2. Update `ALLOWED_ORIGINS` environment variable:
   ```bash
   ALLOWED_ORIGINS=["https://physical-ai-humanoid-robotics.vercel.app"]
   ```
3. Click **"Save Changes"** (triggers redeploy)

---

## Part 3: Initialize Databases

### Option A: Run Scripts Locally (Recommended)

```bash
# 1. Clone repository locally
git clone https://github.com/DanishHaji/Physical-AI-Humanoid-Robotics-Hackathon-I.git
cd Physical-AI-Humanoid-Robotics-Hackathon-I/backend

# 2. Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# 3. Install dependencies
pip install -r requirements.txt

# 4. Create .env file
cp .env.example .env
# Edit .env and add your API keys (same as Render environment variables)

# 5. Initialize Neon database
python scripts/init_neon.py

# 6. Ingest textbook content to Qdrant
python scripts/ingest_to_qdrant.py
```

### Option B: Use Render Shell (Advanced)

1. In Render dashboard → Your service → **"Shell"** tab
2. Run:
   ```bash
   cd /opt/render/project/src
   python scripts/init_neon.py
   python scripts/ingest_to_qdrant.py
   ```

---

## Part 4: Verify Deployment

### Test Backend
```bash
# Health check
curl https://physical-ai-textbook-api.onrender.com/health

# Test RAG query
curl -X POST https://physical-ai-textbook-api.onrender.com/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "What is ROS 2?",
    "mode": "auto"
  }'
```

### Test Frontend
1. Visit your Vercel URL: `https://physical-ai-humanoid-robotics.vercel.app`
2. Navigate to any chapter
3. Try the chatbot widget (bottom-right corner)
4. Ask a question: "What is Physical AI?"

---

## Part 5: Custom Domain (Optional)

### Frontend (Vercel)
1. Go to Vercel dashboard → Your project → **"Settings"** → **"Domains"**
2. Add your domain (e.g., `textbook.yourdomain.com`)
3. Update DNS records as instructed by Vercel

### Backend (Render)
1. Go to Render dashboard → Your service → **"Settings"** → **"Custom Domains"**
2. Add your domain (e.g., `api.yourdomain.com`)
3. Update DNS records as instructed by Render
4. Update frontend `REACT_APP_API_URL` environment variable

---

## Troubleshooting

### Backend Issues

**Problem**: "Application error" or 500 errors
- Check Render logs: Dashboard → Your service → **"Logs"**
- Verify all environment variables are set correctly
- Ensure database is initialized: `python scripts/init_neon.py`

**Problem**: CORS errors in browser
- Update `ALLOWED_ORIGINS` to include your Vercel URL
- Redeploy backend after changing environment variables

**Problem**: Slow first request (cold start)
- Free tier sleeps after 15 minutes
- Consider upgrading to paid tier for always-on
- Or use a cron job to ping `/health` every 10 minutes

### Frontend Issues

**Problem**: Build fails on Vercel
- Check build logs in Vercel dashboard
- Verify `package.json` has correct dependencies
- Try building locally first: `npm run build`

**Problem**: Chatbot not working
- Check browser console for errors
- Verify `REACT_APP_API_URL` points to correct backend URL
- Test backend endpoint directly first

**Problem**: 404 errors on routes
- Docusaurus uses client-side routing
- Vercel handles this automatically
- If issues persist, check `vercel.json` configuration

---

## Monitoring & Maintenance

### Backend (Render)
- **Logs**: Dashboard → Your service → **"Logs"**
- **Metrics**: Dashboard → Your service → **"Metrics"**
- **Free tier limits**: 750 hours/month (sleeps after inactivity)

### Frontend (Vercel)
- **Analytics**: Dashboard → Your project → **"Analytics"**
- **Build logs**: Dashboard → Your project → **"Deployments"**
- **Bandwidth**: Unlimited on free tier

### Databases
- **Qdrant**: Cloud dashboard shows storage usage (1GB limit)
- **Neon**: Dashboard shows compute hours (100h/month free)

---

## Cost Optimization

### Current Setup (100% Free)
- **Vercel**: Unlimited deployments, bandwidth
- **Render**: 750 hours/month (with sleep)
- **Groq**: 30 requests/min
- **Qdrant**: 1GB vector storage
- **Neon**: 0.5GB database, 100 compute hours/month

### If You Exceed Free Tiers
- **Render paid**: $7/month (no sleep, better CPU)
- **Vercel Pro**: $20/month (team features, analytics)
- **Qdrant paid**: $25/month (5GB storage)
- **Neon paid**: $19/month (3GB storage)

---

## Next Steps

1. **Add analytics**: Google Analytics, Plausible, or Vercel Analytics
2. **Set up monitoring**: UptimeRobot for uptime monitoring
3. **Implement caching**: Add Redis for better performance
4. **Add authentication**: Implement user login/signup
5. **CI/CD**: GitHub Actions for automated testing

---

## Support

- **Documentation**: See main README.md
- **Issues**: https://github.com/DanishHaji/Physical-AI-Humanoid-Robotics-Hackathon-I/issues
- **Panaversity**: https://www.panaversity.com

---

**Deployment Checklist**

- [ ] Render backend deployed and running
- [ ] Vercel frontend deployed and running
- [ ] All environment variables configured
- [ ] Neon database initialized
- [ ] Qdrant collection populated with embeddings
- [ ] CORS configured correctly
- [ ] Health endpoint returning 200
- [ ] RAG chatbot working on frontend
- [ ] Custom domain configured (optional)
- [ ] Monitoring set up

---

Built with ❤️ by Danish | Deployed with Vercel + Render
